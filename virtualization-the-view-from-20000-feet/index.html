<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  
  <link rel="stylesheet" href="../vendor/katex/katex.min.css">
<script defer type="text/javascript" src="../vendor/katex/katex.min.js"></script>
<script defer type="text/javascript" src="../vendor/katex/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
  
  <link rel="stylesheet" type="text/css" href="../css/syntax.css">
  <link rel="stylesheet" type="text/css" href="../css/tufte.css">
  <link rel="stylesheet" type="text/css" href="../css/custom.css">
  
  <title>Virtualization (The View from 20,000 Feet) - talks</title>
  
</head>
<body>
        <nav class="group">
          <a href="../">home</a>
          <a href="https://github.com/contrun/talks/">github</a>
      </nav>

  <article>
    <section>
      <div class="post_title">
  <h2 class="post_title"><a href=".././virtualization-the-view-from-20000-feet/">Virtualization (The View from 20,000 Feet)</a></h2>
</div>

<div class="info">
    Posted on March  1, 2022
    
</div>


<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#the-crux-how-to-virtualize-the-machine-underneath-the-os">THE CRUX: HOW TO VIRTUALIZE THE MACHINE UNDERNEATH THE OS?</a></li>
<li><a href="#popek-and-goldberg-virtualization-requirements">Popek and Goldberg virtualization requirements</a>
<ul>
<li><a href="#sensentive-instructions">Sensentive Instructions</a>
<ul>
<li><a href="#control-sensitive">Control-sensitive</a></li>
<li><a href="#behavior-senstive">Behavior-senstive</a></li>
</ul></li>
<li><a href="#popek-and-goldberg-first-theorem">Popek and Goldberg First theorem</a></li>
<li><a href="#trap-and-emulate">Trap and Emulate</a></li>
</ul></li>
<li><a href="#vt-x">VT-x</a>
<ul>
<li><a href="#virtual-machine-extensions">Virtual Machine Extensions</a></li>
<li><a href="#life-cycle-of-vmm-software">Life Cycle of VMM Software</a></li>
<li><a href="#vmcs">VMCS</a>
<ul>
<li><a href="#whats-it">What’s it?</a></li>
<li><a href="#whats-in-it">What’s in it?</a></li>
</ul></li>
</ul></li>
<li><a href="#kvm">KVM</a>
<ul>
<li><a href="#write-your-own-hypervisor">Write your own hypervisor</a></li>
</ul></li>
<li><a href="#qemu">Qemu</a></li>
<li><a href="#next-step">Next step</a>
<ul>
<li><a href="#other-virtualization-techniques">other virtualization techniques</a></li>
<li><a href="#memory-virtualization">memory virtualization</a></li>
<li><a href="#interupt-virtualiazation">interupt virtualiazation</a></li>
<li><a href="#more-platforms">more platforms</a></li>
<li><a href="#virtualization-on-platforms-whose-isa-does-not-support-virtualisation">virtualization on platforms whose ISA does not support virtualisation</a></li>
<li><a href="#performance">performance</a></li>
<li><a href="#static-partition-virtualization">static partition virtualization</a></li>
<li><a href="#os-level-virtualization">OS-level virtualization</a></li>
<li><a href="#para-virtualization">para-virtualization</a></li>
<li><a href="#emulation">emulation</a></li>
</ul></li>
</ul>
</div>
<h1 id="the-crux-how-to-virtualize-the-machine-underneath-the-os">THE CRUX: HOW TO VIRTUALIZE THE MACHINE UNDERNEATH THE OS?</h1>
<p>The virtual machine monitor must transparently virtualize the machine underneath the OS; what are the techniques required to do so?</p>
<h1 id="popek-and-goldberg-virtualization-requirements">Popek and Goldberg virtualization requirements</h1>
<h2 id="sensentive-instructions">Sensentive Instructions</h2>
<h3 id="control-sensitive">Control-sensitive</h3>
<p>Update system state, e.g. change GDTR, direct access to PM, VMXON.</p>
<h3 id="behavior-senstive">Behavior-senstive</h3>
<p>Semeantics depends on the system state, e.g. visibility to IDT.</p>
<h2 id="popek-and-goldberg-first-theorem">Popek and Goldberg First theorem</h2>
<p>For any conventional third-generation computer, a virtual machine monitor may be constructed if the set of sensitive instructions for that computer is a subset of the set of privileged instructions.</p>
<h2 id="trap-and-emulate">Trap and Emulate</h2>
<p><img src="../pictures/syscall-with-and-without-vmm.png" /></p>
<p>source: <a href="https://pages.cs.wisc.edu/~remzi/OSTEP/vmm-intro.pdf">Operating Systems: Three Easy Pieces</a></p>
<h1 id="vt-x">VT-x</h1>
<h2 id="virtual-machine-extensions">Virtual Machine Extensions</h2>
<ul>
<li>Root/Non-root modes</li>
<li>VM instructions</li>
</ul>
<h2 id="life-cycle-of-vmm-software">Life Cycle of VMM Software</h2>
<p><img src="../pictures/vmm-guests-life-cycle.png" /></p>
<p>source: <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html">Intel® 64 and IA-32 Architectures Software Developer Manuals</a></p>
<h2 id="vmcs">VMCS</h2>
<h3 id="whats-it">What’s it?</h3>
<p>A data structuwre which control the behavior of processor in VMX non-root mode and control VMX transitions. <img src="../pictures/interaction-of-hypervisor-and-guests.png" /></p>
<p>source: <a href="https://doi.org/10.2200/S00754ED1V01Y201701CAC038">Hardware and Software Support for Virtualization</a></p>
<h3 id="whats-in-it">What’s in it?</h3>
<p><a href="https://github.com/LordNoteworthy/cpu-internals/blob/master/VMCS-Layout.pdf">VMCS-Layout.pdf</a></p>
<h1 id="kvm">KVM</h1>
<h2 id="write-your-own-hypervisor">Write your own hypervisor</h2>
<p>source: <a href="https://lwn.net/Articles/658511/">Using the KVM API ​</a></p>
<h1 id="qemu">Qemu</h1>
<p><img src="../pictures/io-emulation-in-kvm-qemu.png" /></p>
<p>source: <a href="https://doi.org/10.2200/S00754ED1V01Y201701CAC038">Hardware and Software Support for Virtualization</a></p>
<h1 id="next-step">Next step</h1>
<h2 id="other-virtualization-techniques">other virtualization techniques</h2>
<p><img src="../pictures/comparison-of-virtualization-techniques.png" /></p>
<p>source: <a href="https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/techpaper/VMware_paravirtualization.pdf">Understanding Full Virtualization, Paravirtualization, and Hardware Assist</a></p>
<h2 id="memory-virtualization">memory virtualization</h2>
<h2 id="interupt-virtualiazation">interupt virtualiazation</h2>
<h2 id="more-platforms">more platforms</h2>
<h2 id="virtualization-on-platforms-whose-isa-does-not-support-virtualisation">virtualization on platforms whose ISA does not support virtualisation</h2>
<h2 id="performance">performance</h2>
<h2 id="static-partition-virtualization">static partition virtualization</h2>
<h2 id="os-level-virtualization">OS-level virtualization</h2>
<h2 id="para-virtualization">para-virtualization</h2>
<h2 id="emulation">emulation</h2>


    </section>
  </article>
  
</body>
</html>
